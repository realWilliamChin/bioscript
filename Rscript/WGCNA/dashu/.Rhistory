#画TOM图，非常耗时
dissTOM = 1-TOM;
plotTOM = dissTOM^7;
diag(plotTOM) = NA;
tiff(file="fpkm-heatmap.tif")
TOMplot(plotTOM, geneTree, moduleColors, main = "Network heatmap plot, all genes");
dev.off()
# 使用动态剪切树构建模块：
minModuleSize = 100;
# 动态切割树:
dynamicMods = cutreeDynamic(dendro = geneTree, distM = dissTOM, deepSplit = 2, pamRespectsDendro = FALSE, minClusterSize = minModuleSize);
table(dynamicMods)
dynamicMods
dynamicColors = labels2colors(dynamicMods)
table(dynamicColors)
png("dynamic_tree_cut.png",width = 800,height = 600)
plotDendroAndColors(geneTree, dynamicColors, "Dynamic Tree Cut",dendroLabels = FALSE, hang = 0.03,addGuide = TRUE, guideHang = 0.05,main = "Gene dendrogram and module colors")
dev.off()
MEList = moduleEigengenes(datExpr, colors = dynamicColors)
MEs = MEList$eigengenes
# Calculate dissimilarity of module eigengenes
MEDiss = 1-cor(MEs);#计算模块和模块之间的相关性和相异性
# Cluster module eigengenes
METree = hclust(as.dist(MEDiss), method = "average");
png("Clustering_of_module_eigengenes1_0.06.png",width = 800,height = 600)
plot(METree, main = "Clustering of module eigengenes",     xlab = "", sub = "")
#######################这个地方需要手动选择理想的cutoff,这个值越大，模块数越少##################################
##################MEDissThres值的选择根据Clustering_of_module_eigengenes1.png图来决定，值越大，模块数越少
MEDissThres = 0.06
#save.image(file='temp.RData')
# Plot the cut line into the dendrogram
abline(h=MEDissThres, col = "red")
dev.off()
png("Clustering_of_module_eigengenes1_0.15.png",width = 800,height = 600)
plot(METree, main = "Clustering of module eigengenes",     xlab = "", sub = "")
#######################这个地方需要手动选择理想的cutoff,这个值越大，模块数越少##################################
##################MEDissThres值的选择根据Clustering_of_module_eigengenes1.png图来决定，值越大，模块数越少
MEDissThres = 0.15
#save.image(file='temp.RData')
# Plot the cut line into the dendrogram
abline(h=MEDissThres, col = "red")
dev.off()
png("Clustering_of_module_eigengenes1_0.2.png",width = 800,height = 600)
plot(METree, main = "Clustering of module eigengenes",     xlab = "", sub = "")
#######################这个地方需要手动选择理想的cutoff,这个值越大，模块数越少##################################
##################MEDissThres值的选择根据Clustering_of_module_eigengenes1.png图来决定，值越大，模块数越少
MEDissThres = 0.2
#save.image(file='temp.RData')
# Plot the cut line into the dendrogram
abline(h=MEDissThres, col = "red")
dev.off()
png("Clustering_of_module_eigengenes1_0.3.png",width = 800,height = 600)
plot(METree, main = "Clustering of module eigengenes",     xlab = "", sub = "")
#######################这个地方需要手动选择理想的cutoff,这个值越大，模块数越少##################################
##################MEDissThres值的选择根据Clustering_of_module_eigengenes1.png图来决定，值越大，模块数越少
MEDissThres = 0.2
#######################这个地方需要手动选择理想的cutoff,这个值越大，模块数越少##################################
##################MEDissThres值的选择根据Clustering_of_module_eigengenes1.png图来决定，值越大，模块数越少
MEDissThres = 0.3
#save.image(file='temp.RData')
# Plot the cut line into the dendrogram
abline(h=MEDissThres, col = "red")
dev.off()
# Call an automatic merging function MEDissThres=0.1
MEDissThres = 0.3
merge = mergeCloseModules(datExpr, dynamicColors, cutHeight = MEDissThres, verbose = 3)
str(merge)
# The merged module colors
mergedColors = merge$colors;
# Eigengenes of the new merged modules:
mergedMEs = merge$newMEs
png("dynamicColors_mergedColors.png",width = 800,height = 600)
plotDendroAndColors(geneTree, cbind(dynamicColors, mergedColors),c("Dynamic Tree Cut", "Merged dynamic"),dendroLabels = FALSE, hang = 0.03,addGuide = TRUE, guideHang = 0.05)
dev.off()
#绘制两两模块间的邻接矩阵
png("wgcna.adjacency.heatmap.png",height = 1000,width = 900)
plotEigengeneNetworks(MEs, "Eigengene adjacency heatmap",plotDendrograms = F,marDendro = c(4,4,2,4))
dev.off()
moduleColors = merge$colors
MEs0 = moduleEigengenes(datExpr, moduleColors)$eigengenes
MEs = orderMEs(MEs0);
MEs
colnames(MEs)
module_order = names(MEs) %>% gsub("ME","", .)
MEs$treatment = row.names(MEs)
head(MEs)
class(MEs)
row.names(MEs)
colnames(MEs)
MEs.out<-MEs[c(ncol(MEs),1:(ncol(MEs)-1))]
colnames(MEs.out)<-gsub("ME", "", colnames(MEs.out))
write.table(MEs.out,"sample_module_cor.txt",sep="\t",row.names=F,quote=F)
mME = MEs %>%
pivot_longer(-treatment) %>%
mutate(
name = gsub("ME", "", name),
name = factor(name, levels = module_order)
)
head(mME)
class(mME)
mME$treatment<-factor(mME$treatment,levels=unique(mME$treatment))
mME %>% ggplot(., aes(x=treatment, y=name, fill=value)) +
geom_tile() +
theme_bw() +
scale_fill_gradient2(
low = "blue",
high = "red",
mid = "white",
midpoint = 0,
limit = c(-1,1)) +
theme(axis.text.x = element_text(angle=90)) +
labs(title = "Module-trait Relationships", y = "Modules", fill="corr")->mME.plot
# 获取x轴和y轴标签数量
x_label_count <- length(unique(mME$treatment))
y_label_count <- length(unique(mME$name))
# 计算图片的宽度和高度
image_width <- 2 + x_label_count / 4 # 根据x轴标签数量调整宽度
image_height <- 2 + y_label_count / 4 # 根据y轴标签数量调整高度
# 保存图形，指定图片的宽度和高度
ggsave("sample_module_cor.pdf", mME.plot, width = image_width, height = image_height, dpi = 320)
MEs<-MEs[1:(ncol(MEs)-1)]
colnames(MEs)
for(module in substring(colnames(MEs),3)){
#if(module == "grey") next
ME=as.data.frame(MEs[,paste("ME",module,sep="")])
colnames(ME)=module
datModExpr=datExpr[,moduleColors==module]
datKME = signedKME(datModExpr, ME)
datKME=cbind(datKME,rep(module,length(datKME)))
write.table(datKME,quote = F,row.names = T,append = T,file = "All_Gene_KME.txt",col.names = F,sep="\t")
}
for(module in substring(colnames(MEs),3)){
#if(module == "grey") next
ME=MEs[,paste("ME",module,sep="")]
png(paste("wgcna.", module, ".express.barplot.png", sep=""),height = 700,width = 900)
par(mfrow=c(2,1),mar=c(0.3,5.5,3,2))
plotMat(t(scale(datExpr[,moduleColors==module])),rlabels=F,main=module,cex.main=2,clabels=F)
names(ME)<-rownames(MEs)
par(mar=c(5,4.2,0,0.7))
barplot(ME,col=module,main="",cex.main=2,ylab="eigengene expression",xlab="",las=2)
dev.off()
}
for(module in substring(colnames(MEs),3)){
#if(module == "grey") next
probes = colnames(datExpr)
inModule = is.finite(match(moduleColors, module))
modProbes = probes[inModule]
modTOM = TOM[inModule, inModule]
dimnames(modTOM) = list(modProbes, modProbes)
cyt = exportNetworkToCytoscape(modTOM,edgeFile = paste("CytoscapeInput-edges-", module, ".txt", sep=""),nodeFile = paste("CytoscapeInput-nodes-", module, ".txt", sep=""),weighted = TRUE,threshold = 0.2,nodeNames = modProbes,nodeAttr = moduleColors[inModule])
}
##############################################################################################################
dir()
edge_files<-grep("CytoscapeInput-edges-",dir(),value = T)
class(edge_files)
weight_value<-NULL
weight_value_df<-as.data.frame(matrix(1:8,nrow=1))
i<-NULL
for (i in 1:length(edge_files)) {
temp_df <-read.table(edge_files[i],header=T,sep="\t",check.names = F,quote='',stringsAsFactors = F)
temp_color<-gsub("CytoscapeInput-edges-",'',edge_files[i])
temp_color<-gsub(".txt",'',temp_color)
if (nrow(temp_df)==0) {
weight_value_df[i,]<-c(temp_color,nrow(temp_df),as.numeric(quantile(0)),0)
next
}
weight_value_df[i,]<-c(temp_color,nrow(temp_df),as.numeric(quantile(temp_df[,3])),mean(temp_df[,3]))
weight_value<-c(weight_value,temp_df[,3])
}
weight_value<-as.numeric(weight_value)
length(weight_value)
colnames(weight_value_df)<-c("module","edge_count","q0","q25","q50","q75","q100","mean_value")
write.table(weight_value_df,"edge_weighted_value.txt",sep="\t",quote=F,row.names=F)
weight_value_df
#WeightValue_60<-quantile(weight_value,0.6)
par(mar=c(5.1,4.1,4.1,2.1))
pdf("histogram_edge_weight_value.pdf",width=9,height=5)
hist(weight_value,breaks=100,col = "light blue")
dev.off()
png("histogram_edge_weight_value.png",height = 1000,width = 900)
hist(weight_value,breaks=100,col = "light blue")
dev.off()
for (sub_edge_file in edge_files) {
edge_tmp_df<-read.table(sub_edge_file,header=T,sep="\t",check.names = F,quote='',stringsAsFactors = F)
if(nrow(edge_tmp_df) == 0){next}
#edge_tmp_df<-edge_tmp_df[edge_tmp_df[,3]>=WeightValue_60,]
node_freq<-as.data.frame(table(edge_tmp_df[,1]))
node_freq<-node_freq[order(-node_freq[,2]),]
if (nrow(node_freq)>100) {
node_freq<-node_freq[1:100,]
}
sub_edge_file_out<-paste0(sub_edge_file,"_Top100.txt",sep="")
edge_out_df<-edge_tmp_df[edge_tmp_df[,1] %in% node_freq[,1],]
write.table(edge_out_df,file = sub_edge_file_out,row.names=F,quote=F,sep="\t")
sub_node_file <- gsub("edges","nodes",sub_edge_file)
node_tmp_df<-read.table(sub_node_file,header=T,sep="\t",check.names = F,quote='',stringsAsFactors = F)
node_out_name<-unique(c(edge_out_df[,1]))
node_out_df<-node_tmp_df[node_tmp_df[,1] %in% node_out_name,]
node_out_df<-node_out_df[match(node_freq[,1],node_out_df[,1]),]
sub_node_file_out<-paste0(sub_node_file,"_Top100.txt",sep="")
write.table(node_out_df,file = sub_node_file_out,row.names=F,quote=F,sep="\t")
}
#########################################################################################################
#save.image(file='temp.RData')
loadedNamespaces("temp.RData")
setwd("C:/Users/Analysis/OneDrive/Work/zhiwusuo/01_Work/01_Ref/2023_10_16_小麦/WGCNA/J7")
#save.image(file='temp.RData')
load("temp.RData")
# Plot the cut line into the dendrogram
abline(h=MEDissThres, col = "red")
png("Clustering_of_module_eigengenes1_0.1.png",width = 800,height = 600)
plot(METree, main = "Clustering of module eigengenes",     xlab = "", sub = "")
#######################这个地方需要手动选择理想的cutoff,这个值越大，模块数越少##################################
##################MEDissThres值的选择根据Clustering_of_module_eigengenes1.png图来决定，值越大，模块数越少
MEDissThres = 0.1
#save.image(file='temp.RData')
#load("temp.RData")
# Plot the cut line into the dendrogram
abline(h=MEDissThres, col = "red")
dev.off()
png("Clustering_of_module_eigengenes1_0.1.png",width = 800,height = 600)
plot(METree, main = "Clustering of module eigengenes",     xlab = "", sub = "")
png("Clustering_of_module_eigengenes1_0.06.png",width = 800,height = 600)
plot(METree, main = "Clustering of module eigengenes",     xlab = "", sub = "")
#######################这个地方需要手动选择理想的cutoff,这个值越大，模块数越少##################################
##################MEDissThres值的选择根据Clustering_of_module_eigengenes1.png图来决定，值越大，模块数越少
MEDissThres = 0.06
#save.image(file='temp.RData')
#load("temp.RData")
# Plot the cut line into the dendrogram
abline(h=MEDissThres, col = "red")
dev.off()
png("Clustering_of_module_eigengenes1_0.07.png",width = 800,height = 600)
plot(METree, main = "Clustering of module eigengenes",     xlab = "", sub = "")
#######################这个地方需要手动选择理想的cutoff,这个值越大，模块数越少##################################
##################MEDissThres值的选择根据Clustering_of_module_eigengenes1.png图来决定，值越大，模块数越少
MEDissThres = 0.07
#save.image(file='temp.RData')
#load("temp.RData")
# Plot the cut line into the dendrogram
abline(h=MEDissThres, col = "red")
dev.off()
# Call an automatic merging function MEDissThres=0.1
MEDissThres = 0.7
merge = mergeCloseModules(datExpr, dynamicColors, cutHeight = MEDissThres, verbose = 3)
str(merge)
# The merged module colors
mergedColors = merge$colors;
# Eigengenes of the new merged modules:
mergedMEs = merge$newMEs
png("dynamicColors_mergedColors.png",width = 800,height = 600)
plotDendroAndColors(geneTree, cbind(dynamicColors, mergedColors),c("Dynamic Tree Cut", "Merged dynamic"),dendroLabels = FALSE, hang = 0.03,addGuide = TRUE, guideHang = 0.05)
dev.off()
#绘制两两模块间的邻接矩阵
png("wgcna.adjacency.heatmap.png",height = 1000,width = 900)
plotEigengeneNetworks(MEs, "Eigengene adjacency heatmap",plotDendrograms = F,marDendro = c(4,4,2,4))
dev.off()
moduleColors = merge$colors
MEs0 = moduleEigengenes(datExpr, moduleColors)$eigengenes
MEs = orderMEs(MEs0);
MEs
colnames(MEs)
module_order = names(MEs) %>% gsub("ME","", .)
MEs$treatment = row.names(MEs)
head(MEs)
class(MEs)
row.names(MEs)
colnames(MEs)
MEs.out<-MEs[c(ncol(MEs),1:(ncol(MEs)-1))]
colnames(MEs.out)<-gsub("ME", "", colnames(MEs.out))
write.table(MEs.out,"sample_module_cor.txt",sep="\t",row.names=F,quote=F)
mME = MEs %>%
pivot_longer(-treatment) %>%
mutate(
name = gsub("ME", "", name),
name = factor(name, levels = module_order)
)
head(mME)
class(mME)
mME$treatment<-factor(mME$treatment,levels=unique(mME$treatment))
mME %>% ggplot(., aes(x=treatment, y=name, fill=value)) +
geom_tile() +
theme_bw() +
scale_fill_gradient2(
low = "blue",
high = "red",
mid = "white",
midpoint = 0,
limit = c(-1,1)) +
theme(axis.text.x = element_text(angle=90)) +
labs(title = "Module-trait Relationships", y = "Modules", fill="corr")->mME.plot
# 获取x轴和y轴标签数量
x_label_count <- length(unique(mME$treatment))
y_label_count <- length(unique(mME$name))
# 计算图片的宽度和高度
image_width <- 2 + x_label_count / 4 # 根据x轴标签数量调整宽度
image_height <- 2 + y_label_count / 4 # 根据y轴标签数量调整高度
# 保存图形，指定图片的宽度和高度
ggsave("sample_module_cor.pdf", mME.plot, width = image_width, height = image_height, dpi = 320)
MEs<-MEs[1:(ncol(MEs)-1)]
colnames(MEs)
for(module in substring(colnames(MEs),3)){
#if(module == "grey") next
ME=as.data.frame(MEs[,paste("ME",module,sep="")])
colnames(ME)=module
datModExpr=datExpr[,moduleColors==module]
datKME = signedKME(datModExpr, ME)
datKME=cbind(datKME,rep(module,length(datKME)))
write.table(datKME,quote = F,row.names = T,append = T,file = "All_Gene_KME.txt",col.names = F,sep="\t")
}
for(module in substring(colnames(MEs),3)){
#if(module == "grey") next
ME=MEs[,paste("ME",module,sep="")]
png(paste("wgcna.", module, ".express.barplot.png", sep=""),height = 700,width = 900)
par(mfrow=c(2,1),mar=c(0.3,5.5,3,2))
plotMat(t(scale(datExpr[,moduleColors==module])),rlabels=F,main=module,cex.main=2,clabels=F)
names(ME)<-rownames(MEs)
par(mar=c(5,4.2,0,0.7))
barplot(ME,col=module,main="",cex.main=2,ylab="eigengene expression",xlab="",las=2)
dev.off()
}
for(module in substring(colnames(MEs),3)){
#if(module == "grey") next
probes = colnames(datExpr)
inModule = is.finite(match(moduleColors, module))
modProbes = probes[inModule]
modTOM = TOM[inModule, inModule]
dimnames(modTOM) = list(modProbes, modProbes)
cyt = exportNetworkToCytoscape(modTOM,edgeFile = paste("CytoscapeInput-edges-", module, ".txt", sep=""),nodeFile = paste("CytoscapeInput-nodes-", module, ".txt", sep=""),weighted = TRUE,threshold = 0.2,nodeNames = modProbes,nodeAttr = moduleColors[inModule])
}
##############################################################################################################
dir()
edge_files<-grep("CytoscapeInput-edges-",dir(),value = T)
class(edge_files)
weight_value<-NULL
weight_value_df<-as.data.frame(matrix(1:8,nrow=1))
i<-NULL
for (i in 1:length(edge_files)) {
temp_df <-read.table(edge_files[i],header=T,sep="\t",check.names = F,quote='',stringsAsFactors = F)
temp_color<-gsub("CytoscapeInput-edges-",'',edge_files[i])
temp_color<-gsub(".txt",'',temp_color)
if (nrow(temp_df)==0) {
weight_value_df[i,]<-c(temp_color,nrow(temp_df),as.numeric(quantile(0)),0)
next
}
weight_value_df[i,]<-c(temp_color,nrow(temp_df),as.numeric(quantile(temp_df[,3])),mean(temp_df[,3]))
weight_value<-c(weight_value,temp_df[,3])
}
weight_value<-as.numeric(weight_value)
length(weight_value)
colnames(weight_value_df)<-c("module","edge_count","q0","q25","q50","q75","q100","mean_value")
write.table(weight_value_df,"edge_weighted_value.txt",sep="\t",quote=F,row.names=F)
weight_value_df
#WeightValue_60<-quantile(weight_value,0.6)
par(mar=c(5.1,4.1,4.1,2.1))
pdf("histogram_edge_weight_value.pdf",width=9,height=5)
hist(weight_value,breaks=100,col = "light blue")
dev.off()
png("histogram_edge_weight_value.png",height = 1000,width = 900)
hist(weight_value,breaks=100,col = "light blue")
dev.off()
for (sub_edge_file in edge_files) {
edge_tmp_df<-read.table(sub_edge_file,header=T,sep="\t",check.names = F,quote='',stringsAsFactors = F)
if(nrow(edge_tmp_df) == 0){next}
#edge_tmp_df<-edge_tmp_df[edge_tmp_df[,3]>=WeightValue_60,]
node_freq<-as.data.frame(table(edge_tmp_df[,1]))
node_freq<-node_freq[order(-node_freq[,2]),]
if (nrow(node_freq)>100) {
node_freq<-node_freq[1:100,]
}
sub_edge_file_out<-paste0(sub_edge_file,"_Top100.txt",sep="")
edge_out_df<-edge_tmp_df[edge_tmp_df[,1] %in% node_freq[,1],]
write.table(edge_out_df,file = sub_edge_file_out,row.names=F,quote=F,sep="\t")
sub_node_file <- gsub("edges","nodes",sub_edge_file)
node_tmp_df<-read.table(sub_node_file,header=T,sep="\t",check.names = F,quote='',stringsAsFactors = F)
node_out_name<-unique(c(edge_out_df[,1]))
node_out_df<-node_tmp_df[node_tmp_df[,1] %in% node_out_name,]
node_out_df<-node_out_df[match(node_freq[,1],node_out_df[,1]),]
sub_node_file_out<-paste0(sub_node_file,"_Top100.txt",sep="")
write.table(node_out_df,file = sub_node_file_out,row.names=F,quote=F,sep="\t")
}
setwd("C:/Users/Analysis/OneDrive/Work/zhiwusuo/00_Script/02_Rscript/WGCNA/dashu")
library(DESeq2)
library(WGCNA)
library(genefilter)
library(tidyverse)
allowWGCNAThreads(32)
options(stringsAsFactors = FALSE)
getwd()
rm(list=ls())
###############读入raw data，DESeq normalize之后保存备份#####################
sp_name<-"dashu"
infile1<-paste0(sp_name,"_reads_matrix_filtered.txt",sep="")
infile2<-paste0(sp_name,"_samples_described.txt",sep="")
data<-read.table(infile1,sep="\t",header=T,stringsAsFactors = F,check.names = F,row.names=1,quote='')
head(data)
colnames(data)
mode(data[[1]])
meta<-read.table(infile2,sep="\t",header=T,check.names = F)
rownames(meta)<-meta$sample
#meta<-meta[1]
meta<-meta[match(colnames(data),meta$sample),]
meta$group<-factor(meta$group)
meta
all(colnames(data) %in% rownames(meta))
all(colnames(data) == rownames(meta))
meta
dds <- DESeqDataSetFromMatrix(countData = round(data), colData = meta, design = ~ group)
dds <- DESeq(dds)
vsd <- varianceStabilizingTransformation(dds)
head(vsd)
class(vsd)
#wpn_vsd<- getVarianceStabilizedData(dds)
#rv_wpn <- rowVars(wpn_vsd)
#q75_wpn <- quantile( rowVars(wpn_vsd), .75)  # <= original
#q95_wpn <- quantile( rowVars(wpn_vsd), .95)  # <= changed to 95 quantile to reduce dataset
#expr_normalized <- wpn_vsd[ rv_wpn > q95_wpn, ]
normalized_counts <- getVarianceStabilizedData(dds)
head(normalized_counts)
range(normalized_counts)
class(normalized_counts)
dim(normalized_counts)
rv_normalized_counts <- rowVars(normalized_counts)
head(rv_normalized_counts)
summary(rv_normalized_counts)
rownames(normalized_counts)
#dim(data)
#View(counts(dds))
#dds <- estimateSizeFactors(dds)
#sizeFactors(dds)
#normalized_counts <- counts(dds, normalized=TRUE)
head(normalized_counts)
normalized_counts<-cbind(as.data.frame(rownames(normalized_counts)),normalized_counts)
colnames(normalized_counts)[1]<-"GeneID"
outfile1<-paste0(sp_name,"_DESeq_counts.txt",sep="")
write.table(normalized_counts, file=outfile1, sep="\t", quote=F, col.names=T,row.names = F)
dim(normalized_counts)
################################anova分析筛选变化大的基因##########################
tmp.group<-meta$group
rownames(normalized_counts)
colnames(normalized_counts)
normalized_counts<-normalized_counts[,-1]
p<-NULL
for (i in rownames(normalized_counts)) {
#print(i);
#print(data[i,])
tmp.count<-as.numeric(normalized_counts[i,])
#tmp.dt<-data.frame(tmp.count,group=rep(c("S1","S3","S2"),each=3))
tmp.dt<-data.frame(tmp.count,group=tmp.group)
colnames(tmp.dt)[1]<-i
tmp.dt$group<-as.factor(tmp.dt$group)
mod <- aov( tmp.dt[,1]~group , data = tmp.dt)
p<-c(p,summary(mod)[[1]][5]$Pr[1])
}
length(p)
normalized_counts$p_value<-p
normalized_counts<-normalized_counts[order(normalized_counts$p_value),]
p.adjust(normalized_counts$p_value,method = "BH")->p.aj
normalized_counts$BH_p_value<-p.aj
df.rname<-data.frame(GeneID=rownames(normalized_counts))
normalized_counts<-cbind(df.rname,normalized_counts)
head(normalized_counts)
outfile2<-paste0(sp_name,"_DESeq_anova_p.txt",sep="")
write.table(normalized_counts,outfile2,sep="\t",quote=F,row.names = F)
###################################获得wgcna的输入数据############################
dim(normalized_counts)
head(normalized_counts)
dt_wgcna<-normalized_counts[normalized_counts$BH_p_value<=0.01,]
dim(dt_wgcna)
dim(dt_wgcna)[0]
class(dt_wgcna)
dim(dt_wgcna)
dim(dt_wgcna)[0][0]
dim(dt_wgcna)[0]
dim(dt_wgcna)$0
dim(dt_wgcna)
View(dt_wgcna)
dim(dt_wgcna).row()
dim(dt_wgcna).row
dim(dt_wgcna)
nrow(dt_wgcna)
if (nrow(dt_wgcna) < 10000 ) {
dt_wgcna <- normalized_counts
}
dim(dt_wgcna)
dim(dt_wgcna)
dt_wgcna<-dt_wgcna[1:10000,1:(ncol(dt_wgcna)-2)]
dim(dt_wgcna)
class(dt_wgcna)
colnames(dt_wgcna)
rownames(dt_wgcna)
meta$sample
expr_normalized_df<-pivot_longer(dt_wgcna,-GeneID)
#expr_normalized_df$name
expr_normalized_df %>% ggplot(., aes(x = factor(name,levels=meta$sample), y = value)) +
geom_violin() +
geom_point() +
theme_bw() +
theme(
axis.text.x = element_text( angle = 90)
) +
ylim(0, NA) +
labs(
title = "Normalized Gene Expression",
x = "Sample",
y = "normalized expression"
)->exp_violin.plot
ggsave("normalized_exp_violin.pdf",exp_violin.plot,dpi=320)
##########################start wgcna analysis dt_wgcna ##################
#########################dt_wgcna 为数据框，第一列为GeneID，行名也是GeneID
datExpr0 = as.data.frame(t(dt_wgcna[, -c(1)]))
colnames(datExpr0)
