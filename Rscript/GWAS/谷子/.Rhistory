setwd("C:/Users/Analysis/OneDrive/Work/zhiwusuo/00_Script/02_Rscript/GWAS/谷子")
getwd()
library("GWASpoly")
rm(list=ls())
dir()
setwd("D:/pll/R_work/guzi_chip/mature")
setwd("C:/Users/Analysis/OneDrive/Work/zhiwusuo/00_Script/02_Rscript/GWAS/谷子")
getwd()
library("GWASpoly")
rm(list=ls())
dir()
prefix<-"mature"
genofile<-paste0(prefix, "_dp1_miss_0.05.csv")
phenofile<-paste0(prefix, "_stage_phe_all.csv")
traits<-13
#######设置样本数
N<-203
#设置miss率为0.05
VCF2dosage(VCF.file=paste0(prefix, "_stage.recode.vcf"),dosage.file = paste0(prefix,"_dp1_miss_0.05.csv"),geno.code="GT",ploidy=2,samples=NULL,min.DP=1, max.missing=0.05, min.minor=5)
data <- read.GWASpoly(ploidy=2, pheno.file=phenofile, geno.file=genofile,
format="numeric", n.traits=traits, delim=",")
class(data)
#data.loco <- set.K(data,LOCO=TRUE,n.core=2)
###为了做后面的qtl，所以这里选择参数LOCO=F
data.original <- set.K(data,LOCO=FALSE,n.core=2)
params <- set.params(geno.freq = 1 - 2/N, fixed = "env", fixed.type = "factor",MAF = 0.01,n.PC=5)
#data.loco.scan
data.original.scan <- GWASpoly(data.original,models=c("additive","1-dom"),
params=params,n.core=2)
#?GWASpoly
library(ggplot2)
for(i in paste0("trait",1:traits)){
qq.p<-qq.plot(data.original.scan,trait= i) + ggtitle(label="Original")
outfile<-paste0(prefix,i,"_qq.jpeg")
ggsave(outfile,qq.p,dpi=350)
}
rm(i)
#data2 <- set.threshold(data.original.scan,method="Bonferroni",level=0.05)
data2 <- set.threshold(data.original.scan,method="M.eff",level=0.05)
#########上面这一步产生-log10(p)的阈值，会显示在后面的曼哈顿图中，要记录下来，这个样品中是5.56
class(data2)
summary(data2)
#paste0("trait",1:10)
#p <- manhattan.plot(data2,traits=paste0("trait",1:10))
#p
p <- manhattan.plot(data2)+ theme(axis.text.x = element_text(angle=90,vjust=0.5))
ggsave(paste0(prefix, "_traits_all_man.jpeg"),p,dpi=350, width = 10, height = 15)
rm(p)
for(i in paste0("trait",1:traits)){
man.p<-manhattan.plot(data2,traits=i)+ theme(axis.text.x = element_text(angle=90,vjust=0.5))
outfile<-paste0(prefix,i,"_man.jpeg")
ggsave(outfile,man.p,dpi=350)
}
rm(i)
LD.p <- LD.plot(data2, max.loci=1000)
ggsave(paste0(prefix,"_LD.jpeg"),LD.p,dpi=350)
#qtl <- get.QTL(data=data2,traits="disease",models=c("additive","1-dom"),bp.window=5e6)
qtl <- get.QTL(data=data2,models=c("additive","1-dom"),bp.window=5e6)
class(qtl)
knitr::kable(qtl)
dim(qtl)
write.table(qtl,paste0(prefix, "_qtl_result.txt"),quote = F,sep="\t",row.names=F)
#write.GWASpoly(data2, trait="trait1", filename="heading_trait1_gwas.txt", what = "scores", delim = "\t")
for(i in paste0("trait",1:traits)){
outfile<-paste0(prefix,i,"_gwas.txt")
write.GWASpoly(data2, trait=i, filename=outfile, what = "scores", delim = "\t")
}
rm(i)
